<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OneClickPrompts Options</title>
    <!-- Base styles: Root variables, body, container, section, and headings -->
    <link rel="stylesheet" href="/popup-page-styles/popup-base.css" />
    <!-- Layout styles: Row layouts, form controls, and profile action containers -->
    <link rel="stylesheet" href="/popup-page-styles/popup-layout.css" />
    <!-- Custom buttons: Button list container, button items, drag handles, and separators -->
    <link rel="stylesheet" href="/popup-page-styles/popup-buttons.css" />
    <!-- UI Components: Console, save status, export/import buttons, confirmation & error dialogs, and toast notifications -->
    <link rel="stylesheet" href="/popup-page-styles/popup-components.css" />
    <!-- Toggle switch styles: iPhone-style toggle switches -->
    <link rel="stylesheet" href="/common-ui-elements/popup-toggle.css" />
    <!-- Theme overrides: Dark mode styles -->
    <link rel="stylesheet" href="/common-ui-elements/dark-theme.css" />
    <link rel="stylesheet" href="/common-ui-elements/common-style.css" />
    <!-- Toast notifications -->
    <link rel="stylesheet" href="/common-ui-elements/ocp_toast.css" />
  </head>

  <body>
    <div class="container">
      <!-- Profile Section -->
      <section class="section">
        <h2>Profile</h2>
        <div class="row">
          <label
            for="profileSelect"
            id="currentProfileLabel"
            class="profile-context-label"
            style="display: none"
            >Your current profile:</label
          >
          <select
            id="profileSelect"
            title="Select profile"
            aria-label="Select profile"
          >
            <option value="default">Default Profile</option>
          </select>
          <button id="addProfile" title="Create a new, empty profile.">
            Add Profile
          </button>
          <button
            id="copyProfile"
            title="Duplicate the current profile with all its buttons and settings to new profile that you will name."
          >
            Duplicate Current Profile To A New One
          </button>
          <button
            id="deleteProfile"
            class="danger"
            title="Delete the currently selected profile. The 'Default' profile cannot be deleted."
          >
            Delete
          </button>

          <div id="versionContainer">
            <p id="version">Version 0.0.3.4</p>
            <p id="topExplanationText">
              Your changes to the buttons will be saved automatically. Reload
              website to apply. Pressing "Shift" while pressing a key or button
              changes its autosend behavior!

              <a href="#helpSection">Go to Help Section</a>
            </p>
            <button
              id="open-in-tab-button"
              title="Open this settings page in a new browser tab for more space."
            >
              ‚ÜóÔ∏è Expand this page to new tab
            </button>
            <button
              id="toggle-width-button"
              title="Expand page width to 90% of the viewport."
              style="display: none"
            >
              ‚ÜîÔ∏è Make page wider
            </button>
          </div>
        </div>
        <!-- Add Profile Input and Save/Cancel Buttons -->
        <div
          id="addProfileContainer"
          class="profile-action-container"
          style="display: none"
        >
          <label for="addProfileInput">Enter new profile name:</label>
          <input
            type="text"
            id="addProfileInput"
            placeholder="Enter profile name here"
            title="New profile name"
          />
          <button
            id="saveAddProfile"
            title="Save the new profile with the name entered above."
          >
            Save
          </button>
          <button
            id="cancelAddProfile"
            class="danger"
            title="Cancel creating a new profile and hide this input."
          >
            Cancel
          </button>
        </div>
        <!-- Copy Profile Input and Save/Cancel Buttons -->
        <div
          id="copyProfileContainer"
          class="profile-action-container"
          style="display: none"
        >
          <label for="copyProfileInput">Enter duplicate profile name:</label>
          <input
            type="text"
            id="copyProfileInput"
            placeholder="Enter duplicate profile name here"
            title="Name for the duplicated profile"
          />
          <button id="saveCopyProfile">Save</button>
          <button id="cancelCopyProfile" class="danger">Cancel</button>
        </div>
      </section>

      <div id="saveStatus" class="small-hoovering-text">Last saved: Never</div>
      <!-- Button Configuration via button cards (buttons have their UI - each on card that is added dynamically) -->
      <section class="section">
        <h2>Button Configuration</h2>
        <div class="add-button-group">
          <div class="row">
            <input
              type="text"
              id="buttonIcon"
              placeholder="‚ú®"
              class="emoji-input"
              title="Button icon that will be clickable in the chat interface, or you may have text here or multiple emojis. (Emoji menu Win+. Or you may ask AI for them and copy)"
              aria-label="Button icon"
            />

            <textarea
              id="buttonText"
              placeholder="Button Template Text To be Inserted"
              class="text-input"
              rows="1"
              title="This will be inserting text into the chat input when the button is clicked, into textbox after your text"
              aria-label="Button template text"
            ></textarea>
            <label
              class="checkbox-row"
              for="buttonAutoSendToggle"
              title="If checked, clicking the new button will automatically send the prompt. This setting can be overridden by the global auto-send toggle below."
            >
              <input type="checkbox" id="buttonAutoSendToggle" checked />
              <span>Auto-send</span>
            </label>
          </div>
          <div class="row">
            <button
              id="addButton"
              title="Add a new prompt button using the icon, text, and auto-send setting from above."
            >
              Add Button
            </button>
            <button
              id="clearText"
              title="Clear the icon and text fields for adding a new button."
            >
              Clear Text
            </button>
          </div>
        </div>
        <div class="row">
          <button
            id="addSeparator"
            title="Add a visual separator to the button list to organize your prompts."
          >
            Add Separator
          </button>
        </div>
        <div id="buttonCardsList" data-draggable="true">
          <!-- Button cards added dynamically here -->
        </div>
      </section>

      <!-- ===== Settings  ===== -->
      <section class="section">
        <h2>Settings</h2>
        <div class="row">
          <label
            class="checkbox-row"
            for="autoSendToggle"
            title="Global setting for this profile. If unchecked, no buttons will auto-send, overriding individual button settings."
          >
            <input type="checkbox" id="autoSendToggle" />
            <span
              >Enable Global Auto-send for profile. Disabling will disable
              auto-send everywhere.</span
            >
          </label>
        </div>
        <div class="row">
          <label
            class="checkbox-row"
            for="shortcutsToggle"
            title="Enable or disable keyboard shortcuts (Alt+1 through Alt+0) for the first 10 buttons in this profile, so you can press keyboard instead of clicking them. If disabled, you can still click buttons with mouse."
          >
            <input type="checkbox" id="shortcutsToggle" />
            <span>Enable Keyboard Shortcuts</span>
          </label>
        </div>
        <div class="row">
          <button
            id="revertDefault"
            class="danger"
            title="Reset all buttons and settings in the current profile back to the extension's defaults."
          >
            Revert Current Profile to Default
          </button>
        </div>
        <!-- Floating Window Settings -->
        <div class="collapsible" id="floatingWindowSettingsSection">
          <div class="section-header">
            <h2>
              Floating Window Settings
              <span class="expand-text">(click to expand)</span>
            </h2>
            <span class="toggle-icon">‚ñ∂</span>
          </div>
          <div class="section-content">
            <div class="text-inside-container">
              <p>
                Reset the position, size, and visibility of the floating panel.
                This can fix issues if the panel becomes stuck or invisible.
              </p>
            </div>
            <div id="floatingWindowSitesList" class="floating-sites-list">
              <!-- Site-specific reset buttons will be added here dynamically -->
              <p class="empty-message" style="display: none">
                No saved settings found for any website.
              </p>
            </div>
            <div class="row" style="margin-top: 16px">
              <button
                id="resetAllFloatingWindowSettings"
                class="danger"
                title="Reset floating window settings for ALL websites."
              >
                Reset settings for all websites
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Backup Section -->
      <section class="section" id="backupSection">
        <h2>Backup &amp; Restore</h2>
        <div class="row">
          <button
            id="exportProfile"
            title="Download the current profile's settings as a JSON backup file. You can then import this file to another computer or restore in case of data loss."
          >
            Export Profile
          </button>
          <button
            id="importProfile"
            title="Import a profile's settings from a JSON backup file."
          >
            Import Profile
          </button>
          <!-- Hidden file input for importing profile -->
          <input
            type="file"
            id="importFileInput"
            accept="application/json"
            style="display: none"
            title="Import profile file"
            aria-label="Import profile file"
          />
        </div>
        <!-- Confirmation Div -->
        <div
          id="confirmationDiv"
          class="dialog dialog-confirmation"
          style="display: none"
        >
          <p>
            File loaded successfully, but a profile with the same name already
            exists in the system. Do you want to overwrite the existing profile?
          </p>
          <button id="confirmOverwrite">Yes</button>
          <button id="cancelOverwrite">No</button>
        </div>
        <!-- Error Message Div -->
        <div id="errorDiv" class="dialog dialog-error" style="display: none">
          <p>
            Error loading file. Please ensure the file is a valid JSON profile.
          </p>
        </div>
      </section>

      <!-- Console -->
      <section class="section">
        <h2>Console</h2>
        <div id="console" class="console"></div>
      </section>

      <!-- ===== Modules Section ===== -->
      <!-- This is a top-level collapsible container. The .collapsible class enables the expand/collapse behavior via popup-page-collapsible.js -->
      <section class="section collapsible" id="modulesSection">
        <div class="section-header">
          <h2>
            Modules
            <span class="expand-text">(click to expand)</span>
          </h2>
          <span class="toggle-icon">‚ñ∂</span>
        </div>
        <div class="section-content">
          <!-- Cross-Chat Prompt Sharing Module -->
          <!-- This is a nested collapsible module. It has its own .collapsible class and header. -->
          <!-- Its functionality is managed by popup-page-modules-promptShare.js, but its collapsible behavior is managed centrally by popup-page-collapsible.js -->
          <div class="collapsible" id="crossChatModule">
            <div class="section-header subsection-header">
              <h3>
                Cross-Chat Prompt Sharing
                <span class="expand-text">(click to expand)</span>
              </h3>
              <span class="toggle-icon">‚ñ∂</span>
            </div>
            <div class="section-content">
              <div class="switch-container" style="margin-bottom: 16px">
                <!--This label is hidden by CSS to draw beautiful swithc on top-->
                <label class="switch">
                  <input
                    type="checkbox"
                    id="crossChatModuleEnableToggle"
                    aria-label="Enable Cross-Chat Prompt Sharing"
                  />
                  <span class="slider"></span>
                </label>
                <span class="switch-label"
                  >Enable Cross-Chat Prompt Sharing</span
                >
              </div>

              <!-- Cross Chat Module Settings Settings - collapsed by default -->
              <div id="crossChatModuleSettings" style="display: none">
                <div class="text-inside-container" style="margin-bottom: 16px">
                  <p>
                    This module streamlines your workflow when using multiple AI
                    chat services.
                  </p>
                  <ul>
                    <li>
                      <strong>How it works:</strong> On a supported chat page
                      (like ChatGPT), type a prompt and click the
                      <strong style="font-family: 'Segoe UI Emoji'">üìã</strong>
                      button. Then, navigate to another chat page (like Claude)
                      and click the
                      <strong style="font-family: 'Segoe UI Emoji'">üì•</strong>
                      button to paste the same prompt.
                    </li>
                    <li>
                      The prompt is stored globally, so you can copy it once and
                      paste it on multiple different sites. Hovering over the
                      <strong style="font-family: 'Segoe UI Emoji'">üì•</strong>
                      button on a chat page will show you the stored prompt in a
                      tooltip.
                    </li>
                  </ul>
                </div>
                <div class="row">
                  <label for="storedPromptDisplay">Stored Prompt:</label>
                  <textarea
                    id="storedPromptDisplay"
                    class="selector-config-textarea"
                    rows="4"
                    readonly
                    title="This read-only area shows the prompt that is currently saved in the extension's memory. Use the 'Refresh' button to update it."
                    placeholder="No prompt has been saved."
                  ></textarea>
                </div>
                <div class="row" style="justify-content: flex-end">
                  <button
                    id="refreshStoredPrompt"
                    title="Manually fetch and display the currently stored prompt from memory. Useful if you've copied a new prompt in another tab and want to see it here."
                  >
                    Refresh
                  </button>
                  <button
                    id="clearStoredPrompt"
                    class="danger"
                    title="Permanently deletes the prompt currently stored in memory. This cannot be undone."
                  >
                    Clear Stored Prompt
                  </button>
                </div>
                <hr style="margin: 16px 0" />
                <h4>Settings</h4>
                <div
                  class="row"
                  title="If enabled, after you click the 'üìã Copy' button on a chat page, the extension will also immediately 'send' the text in that same chat. This is useful for workflows where you want to send a prompt and simultaneously save it for use elsewhere."
                >
                  <div class="switch-container">
                    <label class="switch">
                      <input type="checkbox" id="crossChatAutosendCopy" />
                      <span class="slider"></span>
                    </label>
                    <span class="switch-label">Autosend after üìã Copy</span>
                  </div>
                </div>
                <div
                  class="row"
                  title="If enabled, clicking the 'üì• Paste & Send' button will not only paste the stored prompt into the chat input but also automatically trigger the send action, submitting it to the AI."
                >
                  <div class="switch-container">
                    <label class="switch">
                      <input type="checkbox" id="crossChatAutosendPaste" />
                      <span class="slider"></span>
                    </label>
                    <span class="switch-label"
                      >Autosend after üì• Paste & Send</span
                    >
                  </div>
                </div>
                <div
                  class="row"
                  style="flex-direction: column; align-items: flex-start"
                >
                  <label>Button Placement:</label>
                  <div
                    style="margin-top: 8px"
                    title="Places the üìã and üì• buttons before your other custom buttons. They will be assigned shortcuts Alt+1 and Alt+2."
                  >
                    <label>
                      <input
                        type="radio"
                        name="crossChatButtonPlacement"
                        value="before"
                        checked
                      />
                      Inject Cross-Chat Buttons <strong>Before</strong> Other
                      Custom Buttons
                    </label>
                  </div>
                  <div
                    title="Places the üìã and üì• buttons after all your other custom buttons. Their shortcuts will follow your last custom button."
                  >
                    <label>
                      <input
                        type="radio"
                        name="crossChatButtonPlacement"
                        value="after"
                      />
                      Inject Cross-Chat Buttons <strong>After</strong> Other
                      Custom Buttons
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <br /><br />
          <!-- Inline Profile Selector Settings - collapsed by default -->
          <div class="collapsible" id="inlineProfileSelectorModule">
            <div class="section-header subsection-header">
              <h3>
                Inline Profile Selector
                <span class="expand-text">(click to expand)</span>
              </h3>
              <span class="toggle-icon">‚ñ∂</span>
            </div>
            <div class="section-content">
              <div class="switch-container" style="margin-bottom: 16px">
                <label class="switch">
                  <input
                    type="checkbox"
                    id="inlineProfileSelectorEnableToggle"
                  />
                  <span class="slider"></span>
                </label>
                <span class="switch-label"
                  >Show profile selector in button row</span
                >
              </div>
              <p class="text-inside-container">
                The selector will appear among the custom buttons in the button
                row, allowing you to switch the current profile quickly.
              </p>

              <!-- Settings visible when enabled -->
              <div
                id="inlineProfileSelectorSettingsContainer"
                style="display: none; margin-left: 20px"
              >
                <div class="text-inside-container" style="margin-bottom: 8px">
                  <p>
                    Choose where the profile selector appears relative to your
                    custom buttons.
                  </p>
                </div>
                <div
                  class="row"
                  style="flex-direction: column; align-items: flex-start"
                >
                  <label>Placement:</label>
                  <div style="margin-top: 8px">
                    <label>
                      <input
                        type="radio"
                        name="inlineProfileSelectorPlacement"
                        value="before"
                        checked
                      />
                      Before custom buttons
                    </label>
                  </div>
                  <div>
                    <label>
                      <input
                        type="radio"
                        name="inlineProfileSelectorPlacement"
                        value="after"
                      />
                      After custom buttons
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <br /><br />
          <!-- ChatGPT Token Approximator Settings - collapsed by default -->
          <div class="collapsible" id="chatgptTokenApproximatorModule">
            <div class="section-header subsection-header">
              <h3>
                ChatGPT Token Approximator
                <span class="expand-text">(click to expand)</span>
              </h3>
              <span class="toggle-icon">‚ñ∂</span>
            </div>
            <div class="section-content">
              <div class="switch-container" style="margin-bottom: 16px">
                <label class="switch">
                  <input
                    type="checkbox"
                    id="chatgptTokenApproximatorEnableToggle"
                  />
                  <span class="slider"></span>
                </label>
                <span class="switch-label"
                  >Enable ChatGPT Token Approximator</span
                >
              </div>
              <!-- Description -->
              <div class="text-inside-container" style="margin-bottom: 16px">
                <p><strong>‚ö†Ô∏è For high performance computers only</strong> ‚Äî gets slower with longer conversations!</p>
                <p>
                  Estimates tokens locally in your browser. Shows <strong>T</strong> (thread) and <strong>E</strong> (editor) chips that auto-refresh and can be clicked.
                  Results are rough, especially with code/non-latin characters. <strong>Token counter CANNOT count tokens in files you upload!</strong>
                </p>
                <p>
                  <strong>Accuracy:</strong> English ¬±2k below ~10k tokens, ¬±10k above. Code/non-English: expect ~50% error. Beyond ~100k: directional only.
                </p>
                <p>
                  <strong>Why care?</strong> Models degrade as context grows‚Äîknowing if you're at ~50k vs ~100k helps you decide to trim/chunk/summarize. Plus, after specific model token limit, chat may "forget" previous messages: this is not guaranteed, as web chats are "black box" - there might be some sort of RAG for previous messages, however, RAG is not as good as direct token input.
                </p>
                <p>
                  For more information, check model limits/benchmarks (e.g., <a href="https://github.com/adobe-research/NoLiMa" target="_blank" rel="noreferrer noopener">NoLiMa</a>). For exact counts use the <a href="https://platform.openai.com/tokenizer" target="_blank" rel="noreferrer noopener">official tokenizer</a>.
                </p>
              </div>

              <!-- Settings (shown when enabled) -->
              <div id="tokenApproxSettingsContainer" style="display:none; margin-left: 8px">
                
                <!-- Calibration Section -->
                <div class="text-inside-container" style="border: 1px solid #ddd; padding: 12px; margin-bottom: 16px; border-radius: 4px">
                  <h4 style="margin: 0 0 8px 0; padding-bottom: 8px; border-bottom: 1px solid #eee">üìä Calibration</h4>
                  <p style="margin: 0 0 8px 0; font-size: 0.9em; color: #666">Scale all token counts up or down if they seem consistently off</p>
                  <div class="row">
                    <label for="tokenApproxCalibration" style="min-width: 120px">Multiply counts by:</label>
                    <input
                      id="tokenApproxCalibration"
                      type="number"
                      inputmode="decimal"
                      step="0.01"
                      min="0.01"
                      max="10"
                      value="1.00"
                      style="width: 100px"
                      title="Multiplies all token estimates by this factor (default 1.00). Use values above 1.0 if counts seem consistently too low for your content, or below 1.0 if they're too high. Helpful for adjusting to your specific mix of languages, code, or writing style."
                      aria-label="Calibration multiplier"
                    />
                  </div>
                </div>

                <!-- Display Options Section -->
                <div class="text-inside-container" style="border: 1px solid #ddd; padding: 12px; margin-bottom: 16px; border-radius: 4px">
                  <h4 style="margin: 0 0 8px 0; padding-bottom: 8px; border-bottom: 1px solid #eee">üëÅÔ∏è What to Display</h4>
                  
                  <!-- Thread Counter Options -->
                  <div style="margin-bottom: 12px">
                    <p style="margin: 0 0 8px 0; font-size: 0.9em; color: #666">Thread counter (T) shows tokens in entire conversation</p>
                    <div style="margin-left: 12px">
                      <div style="margin: 4px 0">
                        <label title="Shows one counter (T) that includes tokens from the entire conversation thread plus any active text editors. This gives you the total context size that would be sent to the AI, including your current draft.">
                          <input type="radio" name="tokenApproxThreadMode" value="withEditors" checked />
                          Thread + editors combined
                        </label>
                      </div>
                      <div style="margin: 4px 0">
                        <label title="Shows one counter (T) that counts only the conversation thread, ignoring text in editors. Useful if you want to see just the conversation history without your current draft affecting the count.">
                          <input type="radio" name="tokenApproxThreadMode" value="ignoreEditors" />
                          Thread only (ignore editors)
                        </label>
                      </div>
                      <div style="margin: 4px 0">
                        <label title="Hides the thread counter completely if you only want to see editor token counts. Choose this if you only care about tracking tokens in your current draft text.">
                          <input type="radio" name="tokenApproxThreadMode" value="hide" />
                          Hide thread counter
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- Editor Counter -->
                  <div style="border-top: 1px solid #f0f0f0; padding-top: 12px">
                    <label class="checkbox-row" for="tokenApproxShowEditorCounter">
                      <input type="checkbox" id="tokenApproxShowEditorCounter" />
                      <span>Show separate editor counter (E)</span>
                    </label>
                    <p style="margin: 4px 0 0 24px; font-size: 0.85em; color: #666">Counts tokens only in active text editor</p>
                  </div>
                </div>

                <!-- Position Section -->
                <div class="text-inside-container" style="border: 1px solid #ddd; padding: 12px; margin-bottom: 16px; border-radius: 4px">
                  <h4 style="margin: 0 0 8px 0; padding-bottom: 8px; border-bottom: 1px solid #eee">üìç Position</h4>
                  <p style="margin: 0 0 8px 0; font-size: 0.9em; color: #666">Where to display token counters relative to buttons</p>
                  <div style="margin-left: 12px">
                    <div style="margin: 6px 0">
                      <label title="Display token counters before your custom buttons">
                        <input type="radio" name="tokenApproxPlacement" value="before" id="tokenApproxPlacementBefore" />
                        <strong>Before buttons</strong>
                      </label>
                    </div>
                    <div style="margin: 6px 0">
                      <label title="Display token counters after your custom buttons">
                        <input type="radio" name="tokenApproxPlacement" value="after" id="tokenApproxPlacementAfter" />
                        <strong>After buttons</strong>
                      </label>
                    </div>
                  </div>
                  <!-- Hidden checkbox for compatibility with existing JavaScript -->
                  <input type="checkbox" id="tokenApproxPlacementBeforeCb" style="display: none;" />
                </div>

                <!-- Algorithm Section -->
                <div class="text-inside-container" style="border: 1px solid #ddd; padding: 12px; border-radius: 4px">
                  <h4 style="margin: 0 0 8px 0; padding-bottom: 8px; border-bottom: 1px solid #eee">‚öôÔ∏è Counting Algorithm</h4>
                  <p style="margin: 0 0 8px 0; font-size: 0.9em; color: #666">Choose a token counting model for your needs</p>
                  
                  <div class="row" style="margin-bottom: 10px;">
                    <label for="tokenApproxCountingMethod" style="min-width: 100px">Model:</label>
                    <select id="tokenApproxCountingMethod" style="flex-grow: 1;" title="Select which token counting model to use">
                      <option value="ultralight-state-machine">Ultralight State Machine (fastest, good accuracy)</option>
                      <option value="single-regex-pass">Single Regex Pass (accurate, 30% slower)</option>
                      <option value="simple">Simple 1:4 Ratio (very fast, less accurate)</option>
                      <option value="advanced">Advanced Heuristics (original algorithm)</option>
                      <option value="cpt-blend-mix">CPT Blend/Mix (variable accuracy, slowest)</option>
                    </select>
                  </div>
                  
                  <!-- Hidden fields for backward compatibility -->
                  <input type="checkbox" id="tokenApproxSimpleMethodToggle" style="display: none;" />
                  <input type="radio" name="tokenApproxCountingMethod" value="advanced" id="tokenApproxMethodAdvanced" style="display: none;" />
                  <input type="radio" name="tokenApproxCountingMethod" value="simple" id="tokenApproxMethodSimple" style="display: none;" />
                  
                  <!-- Model descriptions in collapsible section -->
                  <div style="border-top: 1px solid #f0f0f0; padding-top: 10px; margin-top: 10px;">
                    <p style="margin-bottom: 8px; font-size: 0.9em; cursor: pointer;" id="tokenApproxShowModelDetails">
                      <span class="toggle-icon" style="font-size: 10px; margin-right: 4px;">‚ñ∂</span>
                      Show model details
                    </p>
                    
                    <div id="tokenApproxModelDetails" style="display: none; margin-left: 10px; margin-top: 10px;">
                      <!-- Ultralight State Machine -->
                      <div class="model-description" style="margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px dashed #eee;">
                        <p><strong>Ultralight State Machine</strong> ‚≠ê <span style="color: #090;">‚ö° Fastest</span></p>
                        <p style="font-size: 0.85em; color: #555; margin: 4px 0 6px 0;">
                          This scanner walks the string character by character, toggling an inWord flag to start a new token when word-like characters begin.
                          Each CJK character and each separator symbol increments the token count, while spaces only reset the state.
                          It aims for portability and speed without big regexes, sacrificing some nuance versus the blended model.
                        </p>
                      </div>
                      
                      <!-- Single Regex Pass -->
                      <div class="model-description" style="margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px dashed #eee;">
                        <p><strong>Single Regex Pass</strong> <span style="color: #090;">‚úì Accurate</span></p>
                        <p style="font-size: 0.85em; color: #555; margin: 4px 0 6px 0;">
                          A single Unicode regex matches letter sequences, numbers, individual CJK characters, or any non-whitespace symbol and returns
                          the total matches as the token estimate. 30% slower than Ultralight state machine. The trade-off is coarse granularity‚Äîpunctuation
                          and symbols count as their own tokens, and there's no adjustment for code-heavy or CJK-heavy text.
                        </p>
                      </div>
                      
                      <!-- Simple 1:4 -->
                      <div class="model-description" style="margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px dashed #eee;">
                        <p><strong>Simple 1:4 Ratio</strong> <span style="color: #f90;">‚ö†Ô∏è Less accurate</span></p>
                        <p style="font-size: 0.85em; color: #555; margin: 4px 0 6px 0;">
                          Simple approximation: 1 token ‚âà 4 characters. Very fast and uses minimal CPU, but less accurate especially with code or non-English text.
                          Good for modest machines or extremely long chats where speed matters more than precision.
                        </p>
                      </div>
                      
                      <!-- Advanced Heuristics -->
                      <div class="model-description" style="margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px dashed #eee;">
                        <p><strong>Advanced Heuristics</strong> <span style="color: #e60;">üê¢ Slower</span></p>
                        <p style="font-size: 0.85em; color: #555; margin: 4px 0 6px 0;">
                          Uses intelligent heuristics that adapt to different content types (code, CJK text, etc.) for better accuracy.
                          Can use significant CPU on very long conversations. Blends word-based and character-based estimates.
                        </p>
                      </div>
                      
                      <!-- CPT Blend/Mix -->
                      <div class="model-description" style="margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px dashed #eee;">
                        <p><strong>CPT Blend/Mix</strong> <span style="color: #c00;">üêå Slowest</span></p>
                        <p style="font-size: 0.85em; color: #555; margin: 4px 0 6px 0;">
                          Sometimes best accuracy, sometimes off. 70% slower than Ultralight state machine. It first normalizes the text and gets a word-based count,
                          then computes a character-per-token estimate weighted by content type. Code-ish text and CJK are detected with targeted regexes to adjust CPT
                          and to derive ratios. The final estimate blends the word and char counts with scenario-specific weights and clamps divergence.
                        </p>
                      </div>
                      
                      <p style="font-size: 0.8em; margin-top: 10px;">
                        <a href="https://github.com/NVIDIA/RULER" target="_blank" rel="noreferrer noopener">View RULER token counting benchmark</a>
                      </p>
                      <p style="font-size: 0.8em; margin-top: 4px; font-style: italic; color: #666;">
                        We recommend experimenting with different models to find the best one for your specific use case.
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Help Section -->
      <section class="section" id="helpSection">
        <h2>Help</h2>
        <div class="text-inside-container">
          <p>Some information:</p>
          <p>
            ABSOLUTELY DO BACKUP YOUR PROFILE! IN CASE OF UPDATE, YOU MAY LOSE
            YOUR BUTTONS - ANYTIME. BE SURE TO BACKUP YOUR PROFILE! I am not yet
            skillful enough in JS to make sure all updates will go without
            problems
          </p>
          <ul>
            <li>
              <a href="#" id="openWelcomePage"
                >Open Welcome page <b>with instructions</b> again</a
              >
            </li>
            <li>
              Pressing "Shift" while pressing a key or button changes its
              autosend behavior! Works both with clicks and keyboard shortcuts!
            </li>
            <li>Keyboard shortcuts can be enabled in Settings section</li>
            <li>
              <strong>Queue Feature:</strong> Use the floating panel (click the
              'üîº' button on the chat page) to access the new Queue feature. It
              allows you to send multiple prompts sequentially with a
              configurable delay. Be sure to use it responsibly and in
              accordance with the website's Terms of Service.
            </li>
            <li>
              <strong>Cross-Chat Prompt Sharing:</strong> A new module that lets
              you copy (adds button üìã) a prompt from one AI chat and paste it
              (üì•) into another. Just as usual buttons, allows autosend. Does
              not uses clipboard. A Enable it in the "Modules" section above to
              get started.
            </li>
            <li>
              <strong>Inline Profile Selector:</strong> Enable it in the Modules
              section by toggling ‚ÄúShow profile selector in button row‚Äù. Choose
              placement (before or after custom buttons). The selector will
              appear among the buttons, allowing you to switch the current
              profile quickly.
            </li>
            <li>In case of a problem: first step is to reload your browser.</li>
            <li>
              In case something stopped working completely: The websites often
              change their structure. My extension therefore addresses elements
              that are not longer present. Therefore, when I notice this, I need
              to make an update, and then it takes time for Google to approve
              it.
            </li>
            <li>
              In case something is not working: try to use English version of
              the websites. LLMs do not care about language, so you can use any
              language you want in chat, while keeping interface language
              English. I only test on English languages of webpages, because I
              have to work and have no spare time.
            </li>
            <li>
              If buttons disappear, first step is to refresh the page, then try
              pressing "Reset Floating Window Settings for all pages" up here in
              this popup. You can open an issue on Github:
              <a
                href="https://github.com/MaxITService/ChatGPT-Quick-Buttons-for-your-text/issues"
              >
                Issues page</a
              >
              Or email me at forpphotos@gmail.com
            </li>
            <li>
              In case absolutely nothing works, do the following:
              <ul>
                <li>Export all the profiles you need to JSON files</li>
                <li>Uninstall extension</li>
                <li>
                  Install extension again and test if it's working with default
                  profiles
                </li>
                <li>Import your saved profiles and test again</li>
              </ul>
            </li>
            <li>
              <a
                href="https://github.com/MaxITService/ChatGPT-Quick-Buttons-for-your-text"
                >Github: you can provide code you want to see in app here.</a
              >
            </li>
            <li>
              <a href="https://buymeacoffee.com/netstaff"
                >Donation link. If you are very rich, please send me huge amount
                of money, thank you!</a
              >
            </li>
            <li>
              Introducing changes faster than once in second causes saving
              issues
            </li>
          </ul>
        </div>
      </section>

      <!-- ===== Advanced Selector Configuration ===== -->
      <section class="section collapsible" id="advancedSection">
        <div class="section-header">
          <h2>
            Advanced Selector Configuration
            <span class="expand-text">(click to expand)</span>
          </h2>
          <span class="toggle-icon">‚ñ∂</span>
        </div>
        <div class="section-content">
          <div class="text-inside-container">
            Select, which website you are going to edit selectors for. Selectors
            are pointing to a webpage location where buttons, text, and sending
            button should be.
          </div>
          <br />
          <div class="row">
            <select
              id="selectorWebsiteSelect"
              title="Select website for configuration"
            >
              <option value="ChatGPT">ChatGPT</option>
              <option value="Claude">Claude</option>
              <option value="Copilot">Copilot</option>
              <option value="DeepSeek">DeepSeek</option>
              <option value="AIStudio">AIStudio</option>
              <option value="Grok">Grok</option>
              <option value="Gemini">Gemini</option>
            </select>
          </div>

          <div class="row">
            <label for="selectorConfig">Selector configuration:</label>
            <textarea
              id="selectorConfig"
              class="selector-config-textarea"
              spellcheck="false"
              aria-label="Selector configuration"
              title="Enter selector configuration"
            ></textarea>
          </div>
          <div class="row">
            <button
              id="saveSelectors"
              title="Save your custom CSS selectors for the selected website."
            >
              Save Selectors
            </button>
            <button
              id="resetSelectors"
              class="danger"
              title="Revert the CSS selectors for the selected website to the extension's defaults."
            >
              Reset to Defaults
            </button>
          </div>

          <!-- Collapsible Help Section -->
          <div class="collapsible" id="advancedHelpSection">
            <div class="section-header subsection-header">
              <h3>Help <span class="expand-text">(click to expand)</span></h3>
              <span class="toggle-icon">‚ñ∂</span>
            </div>
            <div class="section-content">
              <div class="text-inside-container">
                <p>
                  Configure custom CSS selectors for different AI chat
                  platforms. Each selector type can have multiple fallback
                  options defined as an array. The extension will use the first
                  matching selector found on the page, with subsequent entries
                  serving as fallbacks.
                </p>
                <ul>
                  <li>
                    <strong>Containers:</strong> The parent elements that
                    contain the chat interface. These elements will host your
                    custom buttons.
                  </li>
                  <li>
                    <strong>Send Buttons:</strong> The submit buttons that send
                    messages. For auto-sending buttons, the extension will
                    automatically trigger these after inserting text.
                  </li>
                  <li>
                    <strong>Editors:</strong> The text input areas where
                    messages are composed. Note that the editor selector might
                    need to be different for empty chats versus chats with
                    existing messages.
                  </li>
                  <li>
                    <strong>Container ID:</strong> A unique identifier for the
                    extension's button container. This is primarily used for
                    internal detection and troubleshooting - modification
                    usually isn't necessary.
                  </li>
                </ul>
                <p>
                  Format: JSON array for containers/sendButtons/editors, string
                  for buttonsContainerId
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- ===== End Advanced Selector Configuration ===== -->

      <!-- =====  Theme Section (Dark Theme Toggle) ===== -->
      <section class="section" id="themeSection">
        <h2>Theme</h2>
        <!-- iPhone-style toggle switch -->
        <div class="switch-container">
          <label class="switch">
            <input
              type="checkbox"
              id="darkThemeToggle"
              aria-label="Enable Dark Theme"
            />
            <span class="slider"></span>
          </label>
          <span class="switch-label">Enable Dark Theme</span>
        </div>
      </section>
      <!-- ===== End Theme Section ===== -->
    </div>

    <!-- Toast Notification Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="log.js"></script>
    <script src="utils.js"></script>
    <script src="/common-ui-elements/ocp_toast.js"></script>
    <script src="/popup-page-scripts/popup-page-visuals.js"></script>
    <!-- NEW SCRIPT: Centralized handler for all collapsible sections -->
    <script src="/popup-page-scripts/popup-page-collapsible.js"></script>
    <script src="/popup-page-scripts/popup-page-profiles.js"></script>
    <script src="/popup-page-scripts/popup-page-backup-handler.js"></script>
    <script src="/popup-page-scripts/popup-page-customButtons.js"></script>
    <script src="/popup-page-scripts/popup-page-script.js"></script>
    <!-- New Theme script for Dark Mode support -->
    <script src="/popup-page-scripts/popup-page-theme.js"></script>
    <!-- Advanced Selector Configuration script -->
    <script src="/popup-page-scripts/popup-page-advanced.js"></script>
    <!-- Floating Window Settings Handler script -->
    <script src="/popup-page-scripts/popup-page-floating-window-handler.js"></script>
    <!-- Cross-Chat Module UI handler script -->
    <script src="/modules/popup-page-modules-promptShare.js"></script>
    <!-- Inline Profile Selector UI handler script -->
    <script src="/modules/popup-page-modules-inlineSelector.js"></script>
    <!-- Token Approximator UI handler script -->
    <script src="/modules/popup-page-modules-tokenApproximator.js"></script>
    <!-- (kept single include to avoid double init) -->
  </body>
</html>
